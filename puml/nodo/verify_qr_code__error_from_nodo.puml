@startuml
!include_many ../common/skin.puml
!include_many ../common/actors.puml

group#Gold verify
	AG -> PS : GET /paymentNotices///<qr code>//
		rnote left
			__header__
			- Version: //<api version>//
			- AcquirerId: //<acquirer id>//
			- Channel: //<channel>//
			- TerminalId: //<terminal id>//
		end note
		
	'!$client = PS
	'!include_many ../session/check.puml
	
	PS -> PS : Retrieve //<psp id>//, //<psp broker id>//, //<password>// by //<acquirer id>//
	
	PS -> PS : parse //<qr code>//: //<institution tax code>//, //<notice number>//
	
	PS -> NP : POST /verifyPaymentNotice
		rnote left
			__request body__
			<verifyPaymentNoticeReq>
			    <idPSP>//<psp id>//</idPSP>
			    <idBrokerPSP>//<psp broker id>//</idBrokerPSP>
			    <idChannel>//<terminal id>//</idChannel>
			    <password>//<password>//</password>
			    <qrCode>
			        <fiscalCode>//<institution tax code>//</fiscalCode>
			        <noticeNumber>//<notice number>//</noticeNumber>
			    </qrCode>
			</verifyPaymentNoticeReq>
		end note

	NP --> PS : HTTP 200 (ok)
		rnote left
			__response body__
			<verifyPaymentNoticeRes>
			    <outcome>KO</outcome>
			    <fault>
			        <faultCode>//<fault code>//</faultCode>
			        <originalFaultString>//<original fault string>//</originalFaultString>
			    </fault>
			</verifyPaymentNoticeRes>
		end note

	PS --> AG : HTTP 200 (ok)
		rnote left
			__response body__
			{
			    "outcome": "//<outcome>//"
			}
		end note
end
@enduml
 