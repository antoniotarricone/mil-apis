@startuml
!include_many ../common/skin.puml
!include_many ../common/actors.puml


group#Gold accept
	AG -> TS : POST /acceptedTermsConds
		rnote left
			__header__
			- Version: //<api version>//
			- AcquirerId: //<acquirer id>//
			- Channel: //<channel>//
			- TerminalId: //<terminal id>//
			- SessionId: //<session id>//
		end note
		
	!$client = TS
	!include_many ../session/check__tc_not_accepted.puml
	
	!include_many ../common/protect_tax_code.puml
	
	TS -> TC : upsertItem ( //<tax code token>//, { "version": , "//<t&c version>//" } )
	
	TC --> TS
	
	!include_many ../save-new-cards/check.puml
	
	group Update session
		TS -> SS : PATCH /sessions///<session id>//
			rnote left
				__header__
				- Version: //<api version>//
				- AcquirerId: //<acquirer id>//
				- Channel: //<channel>//
				- TerminalId: //<terminal id>//
			
				__request body__
				{
					"termsAndCondsAccepted": true,
					"saveNewCards": //<save new cards flag>//
				}
			end note
	
		SS --> TS : HTTP 202 (accepted)
	
		SS -> RD : JSON.SET //<session id>// $.termsAndCondsAccepted 'true'
	
		RD --> SS
		
		SS -> RD : JSON.SET //<session id>// $.saveNewCards '//<save new cards flag>//'
	
		RD --> SS
	end
	
	
	
	TS --> AG : HTTP 201 (created)
		rnote left
			__response body__
			{
				"saveNewCards": //<save new cards flag>//
			}
		end note
end
@enduml